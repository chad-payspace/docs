---
title: "Authentication"
description: "Learn how to authenticate with our API"
---

export const AuthCheck = ({ children }) => {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const checkAuth = async () => {
      try {
        // Check if we have a token in localStorage
        const token = localStorage.getItem('okta_token');
        if (!token) {
          // Redirect to Okta login
          const oktaDomain = 'https://trial-3095457.okta.com';
          const clientId = '0oaqulmsslXJgndNA697';
          const redirectUri = window.location.href;
          const state = btoa(Math.random().toString(36).substring(7));
          localStorage.setItem('okta_state', state);
          
          console.log('Initiating auth with redirect URI:', redirectUri);
          
          const authUrl = `${oktaDomain}/oauth2/default/v1/authorize?` +
            `client_id=${clientId}&` +
            `response_type=code&` +
            `scope=openid%20profile%20email&` +
            `redirect_uri=${encodeURIComponent(redirectUri)}&` +
            `state=${state}&` +
            `nonce=${btoa(Math.random().toString(36).substring(7))}&` +
            `prompt=login&` +
            `sessionToken=${localStorage.getItem('okta_session_token') || ''}`;
          
          console.log('Auth URL:', authUrl);
          window.location.href = authUrl;
          return;
        }

        // Verify token is not expired
        const tokenData = JSON.parse(atob(token.split('.')[1]));
        if (tokenData.exp * 1000 < Date.now()) {
          console.log('Token expired, removing and reloading');
          localStorage.removeItem('okta_token');
          window.location.reload();
          return;
        }

        setIsAuthenticated(true);
      } catch (err) {
        console.error('Auth Error:', err);
        setError(err.message || 'Authentication failed');
        localStorage.removeItem('okta_token');
      } finally {
        setIsLoading(false);
      }
    };

    // Check if we're in the callback URL
    if (window.location.pathname.includes('/visitor-auth/response')) {
      const params = new URLSearchParams(window.location.search);
      const code = params.get('code');
      const state = params.get('state');
      const error = params.get('error');
      const error_description = params.get('error_description');
      
      console.log('Callback params:', {
        code,
        state,
        error,
        error_description,
        expectedState: localStorage.getItem('okta_state')
      });
      
      if (error) {
        console.error('Auth Error:', error, error_description);
        setError(`Authentication Error: ${error_description || error}`);
        localStorage.removeItem('okta_state');
        window.location.href = window.location.origin;
        return;
      }
      
      if (code && state === localStorage.getItem('okta_state')) {
        console.log('Auth successful, storing code');
        localStorage.setItem('okta_code', code);
        localStorage.removeItem('okta_state');
        window.location.href = window.location.origin;
        return;
      }
    }

    checkAuth();
  }, []);

  if (isLoading) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="relative w-16 h-16">
          <div className="absolute inset-0 border-4 border-primary/20 rounded-full"></div>
          <div className="absolute inset-0 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="mt-8 p-6 border rounded-lg bg-red-50 dark:bg-red-900/20">
        <h3 className="text-xl font-semibold mb-4 text-red-600 dark:text-red-400">Authentication Error</h3>
        <p className="text-red-600 dark:text-red-400">{error}</p>
        <p className="mt-4 text-sm text-red-600 dark:text-red-400">
          Please check the browser console for more details and contact your administrator.
        </p>
      </div>
    );
  }

  if (!isAuthenticated) {
    return null;
  }

  return children;
};

## API Authentication

All API requests to Paybilt's endpoints require authentication using a Bearer token. This token must be included in the Authorization header of every request.

### Authentication Header

Include the following header in all API requests:

```http
Authorization: Bearer <your_token>
```

### Example Request

Here's an example of how to make an authenticated request:

```bash
curl -X GET https://api.paybilt.com/v1/transactions \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### Protected Token Management

<AuthCheck>
  <div className="mt-8 p-6 border rounded-lg bg-gray-50 dark:bg-gray-900">
    <h3 className="text-xl font-semibold mb-4">Generate API Token</h3>
    <p className="mb-4">This section is only visible to authenticated users. Here you can generate and manage your API tokens.</p>
    
    <div className="space-y-4">
      <div className="flex items-center space-x-4">
        <button className="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
          Generate New Token
        </button>
        <span className="text-sm text-gray-600 dark:text-gray-400">
          Tokens expire after 30 days
        </span>
      </div>
      
      <div className="mt-4">
        <h4 className="font-medium mb-2">Your Active Tokens</h4>
        <div className="space-y-2">
          <div className="p-3 bg-white dark:bg-gray-800 rounded-lg border">
            <div className="flex justify-between items-center">
              <div>
                <p className="font-mono text-sm">••••••••••••••••••••••••••••••••</p>
                <p className="text-sm text-gray-600 dark:text-gray-400">Created: 2024-04-30</p>
              </div>
              <button className="text-red-600 hover:text-red-700">Revoke</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</AuthCheck>

### Token Security

<Warning>
  Keep your tokens secure and never expose them in client-side code or public repositories.
</Warning>

- Tokens should be stored securely in environment variables or a secure key management system
- Rotate tokens regularly
- Use different tokens for different environments (development, staging, production)
- Never commit tokens to version control

### Error Responses

If authentication fails, you'll receive one of these error responses:

```json
{
  "error": {
    "code": "unauthorized",
    "message": "Invalid or missing authentication token"
  }
}
```

```json
{
  "error": {
    "code": "forbidden",
    "message": "Token has expired or been revoked"
  }
}
```

## Need Help?

If you're having trouble with authentication, please contact our [support team](mailto:support@paybilt.com).
